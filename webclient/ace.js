(function(){var n,q,p=null;n=ace.require("ace/range").Range;q=function(d,b,j){var c;c=b.range;var m,a,f,e,k;a=d.getLines(0,c.start.row);d=e=f=0;for(k=a.length;e<k;d=++e)m=a[d],f+=d<c.start.row?m.length:c.start.column;c=f+c.start.row;d=function(a){a&&p&&p(a)};switch(b.action){case "insertText":j.insert(c,b.text,d);break;case "removeText":j.del(c,b.text.length,d);break;case "insertLines":b=b.lines.join("\n")+"\n";j.insert(c,b,d);break;case "removeLines":b=b.lines.join("\n")+"\n";j.del(c,b.length,d);
break;default:throw Error("unknown action: "+b.action);}};window.sharejs.extendDoc("attach_ace",function(d,b,j){var c,m,a,f,e,k,r,l,s,g;if(!this.provides.text)throw Error("Only text documents can be attached to ace");a=this;p=j;e=d.getSession().getDocument();e.setNewLineMode("auto");c=function(){return window.setTimeout(function(){var h,c;h=e.getValue();c=a.getText();if(h!==c)return console.error("Text does not match!"),console.error("editor: "+h),console.error("ot:     "+c)},0)};b?(a.del(0,a.getText().length),
a.insert(0,e.getValue())):e.setValue(a.getText());c();g=!1;k=function(h){if(!g)return q(e,h.data,a),c()};null!=a.getAttributes&&function(){var h,c;c=d.getSession().getMode().getTokenizer();h=c.getLineTokens;return c.getLineTokens=function(e,d){var b,g,f;null==d||"string"===typeof d?(b=a.createIterator(0),d={modeState:d}):(b=a.cloneIterator(d.iter),a.consumeIterator(b,1));f=h.apply(c,[e,d.modeState]);g=a.consumeIterator(b,e.length);return g.text!==e?f:{tokens:a.mergeTokens(g,f.tokens),state:{modeState:f.state,
iter:a.cloneIterator(b)}}}}();e.on("change",k);f=function(a){g=!0;applyToDoc(e,a);g=!1;return c()};l=function(a){var c,d,b,f,g;d=e.getAllLines();b=f=0;for(g=d.length;f<g;b=++f){c=d[b];if(a<=c.length)break;a-=d[b].length+1}return{row:b,column:a}};a.on("insert",r=function(a,d){g=!0;e.insert(l(a),d);g=!1;return c()});a.on("delete",m=function(a,d){var b;g=!0;b=n.fromPoints(l(a),l(a+d.length));e.remove(b);g=!1;return c()});a.on("refresh",s=function(a,c){var b;b=n.fromPoints(l(a),l(a+c));return d.getSession().bgTokenizer.start(b.start.row)});
a.detach_ace=function(){a.removeListener("insert",r);a.removeListener("delete",m);a.removeListener("remoteop",f);a.removeListener("refresh",s);e.removeListener("change",k);return delete a.detach_ace}})}).call(this);